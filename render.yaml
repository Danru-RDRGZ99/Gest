services:
  # ========= Usuarios =========
  - type: pserv
    name: servicio-usuarios
    runtime: docker
    rootDir: servicio_usuarios
    envVars:
      - key: PORT
        value: "8001"  # <-- CORREGIDO
      - key: DATABASE_URL
        value: "postgresql://admin:29VnOOPbSNH5dWrafi31jQMLVTYyxQrfi@dpg-d44d5i3uibrs73er6k2g-a/laboratorios_2wcy"
      - key: JWT_SECRET_KEY
        value: "<PON_TU_SECRETO_AQUÍ>"
    # healthCheckPath: /openapi.json  <-- ELIMINADO (pserv no lo permite)

  # ========= Reservas =========
  - type: pserv
    name: servicio-reservas
    runtime: docker
    rootDir: servicio_reservas
    envVars:
      - key: PORT
        value: "8002"  # <-- CORREGIDO
      - key: DATABASE_URL
        value: "postgresql://admin:29VnOOPbSNH5dWrafi31jQMLVTYyxQrfi@dpg-d44d5i3uibrs73er6k2g-a/laboratorios_2wcy"
      - key: JWT_SECRET_KEY
        value: "<PON_TU_SECRETO_AQUÍ>"
      - key: USER_SERVICE_URL
        fromService: { name: servicio-usuarios, type: pserv, property: hostport }
    # healthCheckPath: /openapi.json  <-- ELIMINADO

  # ========= Inventario =========
  - type: pserv
    name: servicio-inventario
    runtime: docker
    rootDir: servicio_inventario
    envVars:
      - key: PORT
        value: "8003"  # <-- CORREGIDO
      - key: DATABASE_URL
        value: "postgresql://admin:29VnOOPbSNH5dWrafi31jQMLVTYyxQrfi@dpg-d44d5i3uibrs73er6k2g-a/laboratorios_2wcy"
      - key: JWT_SECRET_KEY
        value: "<PON_TU_SECRETO_AQUÍ>"
      - key: USER_SERVICE_URL
        fromService: { name: servicio-usuarios, type: pserv, property: hostport }
      - key: RESERVA_SERVICE_URL
        fromService: { name: servicio-reservas, type: pserv, property: hostport }
    # healthCheckPath: /openapi.json  <-- ELIMINADO

  # ========= Gateway Nginx =========
  - type: web
    name: gateway-nginx
    runtime: docker
    rootDir: nginx
    healthCheckPath: /__health # <-- ESTE SÍ ESTÁ BIEN (porque es type: web)
    envVars:
      - key: USUARIOS_HOSTPORT
        fromService: { name: servicio-usuarios, type: pserv, property: hostport }
      - key: RESERVAS_HOSTPORT
        fromService: { name: servicio-reservas, type: pserv, property: hostport }
      - key: INVENTARIO_HOSTPORT
        fromService: { name: servicio-inventario, type: pserv, property: hostport }
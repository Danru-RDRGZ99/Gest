# Plano maestro para Render.com

databases:
  - name: gest-db
    databaseName: laboratorios
    user: admin
    plan: free 

services:

  # 1. Servicio de Usuarios
  - type: web
    name: servicio-usuarios
    plan: free
    runtime: docker
    dockerfilePath: ./servicio_usuarios/Dockerfile
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: gest-db
          property: internalConnectionString # <-- ¡CORREGIDO!
      - key: JWT_SECRET_KEY
        generateValue: true 

  # 2. Servicio de Reservas
  - type: web
    name: servicio-reservas
    plan: free
    runtime: docker
    dockerfilePath: ./servicio_reservas/Dockerfile
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: gest-db
          property: internalConnectionString # <-- ¡CORREGIDO!
      - key: JWT_SECRET_KEY
        fromService:
          type: web
          name: servicio-usuarios
          envVarKey: JWT_SECRET_KEY
      - key: USER_SERVICE_URL
        value: http://servicio-usuarios:8001

  # 3. Servicio de Inventario
  - type: web
    name: servicio-inventario
    plan: free
    runtime: docker
    dockerfilePath: ./servicio_inventario/Dockerfile
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: gest-db
          property: internalConnectionString # <-- ¡CORREGIDO!
      - key: JWT_SECRET_KEY
        fromService:
          type: web
          name: servicio-usuarios
          envVarKey: JWT_SECRET_KEY
      - key: USER_SERVICE_URL
        value: http://servicio-usuarios:8001
      - key: RESERVA_SERVICE_URL
        value: http://servicio-reservas:8002

  # 4. El API Gateway (Nginx) - ¡Este es tu servicio público!
  - type: web
    name: gest-gateway
    plan: free
    runtime: docker
    dockerfilePath: ./nginx/Dockerfile